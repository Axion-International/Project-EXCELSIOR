/**
 * 判断是否在浏览器中渲染Angular应用
 * `decorator` 无法直接使用Angular `PLATFORM_ID` 标识
 * 这带来的好处是当服务端自行填充 Document 时也能很好的识别
 */
export const isBrowser = typeof document === 'object' && !!document;
export class StorageUtil {
    static get(storage, key) {
        if (storage == null) {
            return null;
        }
        const value = StorageUtil.parse(storage.getItem(key) || 'null') || null;
        if (value === null)
            return null;
        if (typeof value === 'object' &&
            typeof value._expired !== 'undefined' &&
            value._expired !== 0 &&
            +new Date() > value._expired) {
            StorageUtil.remove(storage, key);
            return null;
        }
        return value._value || null;
    }
    static set(storage, key, value, expiredAt = 0, expiredUnit = 't') {
        if (storage == null) {
            return;
        }
        storage.setItem(key, StorageUtil.stringify({
            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),
            _value: value,
        }));
    }
    static remove(storage, key) {
        if (storage == null) {
            return;
        }
        storage.removeItem(key);
    }
    static key(storage, index) {
        return storage == null ? '' : storage.key(index);
    }
    static getExpired(val, unit) {
        if (val <= 0)
            return 0;
        const now = +new Date();
        switch (unit) {
            case 's': // 秒
                return now + 1000 * val;
            case 'm': // 分
                return now + 1000 * 60 * val;
            case 'h': // 时
                return now + 1000 * 60 * 60 * val;
            case 'd': // 天
                return now + 1000 * 60 * 60 * 24 * val;
            case 'w': // 周
                return now + 1000 * 60 * 60 * 24 * 7 * val;
            case 'y': // 年
                return now + 1000 * 60 * 60 * 24 * 365 * val;
            case 't': // 自定义
                return now + val;
        }
        return 0;
    }
    static stringify(value) {
        return JSON.stringify(value);
    }
    static parse(text) {
        try {
            return JSON.parse(text) || null;
        }
        catch (e) {
            return text;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItd2ViLXN0b3JhZ2UvIiwic291cmNlcyI6WyJzcmMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFZQTs7OztHQUlHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sUUFBUSxLQUFLLFFBQVEsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDO0FBRXBFLE1BQU0sT0FBTyxXQUFXO0lBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBZ0IsRUFBRSxHQUFXO1FBQ3RDLElBQUksT0FBTyxJQUFJLElBQUksRUFBRTtZQUNuQixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN4RSxJQUFJLEtBQUssS0FBSyxJQUFJO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDaEMsSUFDRSxPQUFPLEtBQUssS0FBSyxRQUFRO1lBQ3pCLE9BQU8sS0FBSyxDQUFDLFFBQVEsS0FBSyxXQUFXO1lBQ3JDLEtBQUssQ0FBQyxRQUFRLEtBQUssQ0FBQztZQUNwQixDQUFDLElBQUksSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFDNUI7WUFDQSxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsT0FBTyxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQztJQUM5QixDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQUcsQ0FDUixPQUFnQixFQUNoQixHQUFXLEVBQ1gsS0FBVSxFQUNWLFlBQW9CLENBQUMsRUFDckIsY0FBMkIsR0FBRztRQUU5QixJQUFJLE9BQU8sSUFBSSxJQUFJLEVBQUU7WUFDbkIsT0FBUTtTQUNUO1FBQ0QsT0FBTyxDQUFDLE9BQU8sQ0FDYixHQUFHLEVBQ0gsV0FBVyxDQUFDLFNBQVMsQ0FBQztZQUNwQixRQUFRLEVBQUUsV0FBVyxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDO1lBQ3hELE1BQU0sRUFBRSxLQUFLO1NBQ2QsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFnQixFQUFFLEdBQVc7UUFDekMsSUFBSSxPQUFPLElBQUksSUFBSSxFQUFFO1lBQ25CLE9BQVE7U0FDVDtRQUNELE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVELE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBZ0IsRUFBRSxLQUFhO1FBQ3hDLE9BQU8sT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFFTyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQVcsRUFBRSxJQUFpQjtRQUN0RCxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQUUsT0FBTyxDQUFDLENBQUM7UUFDdkIsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3hCLFFBQVEsSUFBSSxFQUFFO1lBQ1osS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO1lBQzFCLEtBQUssR0FBRyxFQUFFLElBQUk7Z0JBQ1osT0FBTyxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDL0IsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDcEMsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ3pDLEtBQUssR0FBRyxFQUFFLElBQUk7Z0JBQ1osT0FBTyxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDN0MsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQztZQUMvQyxLQUFLLEdBQUcsRUFBRSxNQUFNO2dCQUNkLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQztTQUNwQjtRQUNELE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVPLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBVTtRQUNqQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVPLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBWTtRQUMvQixJQUFJO1lBQ0YsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztTQUNqQztRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXhwaXJhdGlvbiB0aW1lIHVuaXRcbiAqIHM6IHNlY29uZHNcbsKgKiBtOiBtaW51dGVcbsKgKiBoOiBob3VyXG7CoCogZDogZGF5XG7CoCogdzogd2Vla1xuwqAqIHk6IHllYXJcbsKgKiB0OiBDdXN0b20gKG1pbGxpc2Vjb25kKVxuICovXG5leHBvcnQgdHlwZSBFeHBpcmVkVW5pdCA9ICdzJyB8ICdtJyB8ICdoJyB8ICdkJyB8ICd3JyB8ICd5JyB8ICd0JztcblxuLyoqXG4gKiDliKTmlq3mmK/lkKblnKjmtY/op4jlmajkuK3muLLmn5NBbmd1bGFy5bqU55SoXG4gKiBgZGVjb3JhdG9yYCDml6Dms5Xnm7TmjqXkvb/nlKhBbmd1bGFyIGBQTEFURk9STV9JRGAg5qCH6K+GXG4gKiDov5nluKbmnaXnmoTlpb3lpITmmK/lvZPmnI3liqHnq6/oh6rooYzloavlhYUgRG9jdW1lbnQg5pe25Lmf6IO95b6I5aW955qE6K+G5YirXG4gKi9cbmV4cG9ydCBjb25zdCBpc0Jyb3dzZXIgPSB0eXBlb2YgZG9jdW1lbnQgPT09ICdvYmplY3QnICYmICEhZG9jdW1lbnQ7XG5cbmV4cG9ydCBjbGFzcyBTdG9yYWdlVXRpbCB7XG4gIHN0YXRpYyBnZXQoc3RvcmFnZTogU3RvcmFnZSwga2V5OiBzdHJpbmcpOiBhbnkge1xuICAgIGlmIChzdG9yYWdlID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB2YWx1ZSA9IFN0b3JhZ2VVdGlsLnBhcnNlKHN0b3JhZ2UuZ2V0SXRlbShrZXkpIHx8ICdudWxsJykgfHwgbnVsbDtcbiAgICBpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsO1xuICAgIGlmIChcbiAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiZcbiAgICAgIHR5cGVvZiB2YWx1ZS5fZXhwaXJlZCAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgIHZhbHVlLl9leHBpcmVkICE9PSAwICYmXG4gICAgICArbmV3IERhdGUoKSA+IHZhbHVlLl9leHBpcmVkXG4gICAgKSB7XG4gICAgICBTdG9yYWdlVXRpbC5yZW1vdmUoc3RvcmFnZSwga2V5KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZS5fdmFsdWUgfHwgbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBzZXQoXG4gICAgc3RvcmFnZTogU3RvcmFnZSxcbiAgICBrZXk6IHN0cmluZyxcbiAgICB2YWx1ZTogYW55LFxuICAgIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcbiAgICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXG4gICk6IHZvaWQge1xuICAgIGlmIChzdG9yYWdlID09IG51bGwpIHtcbiAgICAgIHJldHVybiA7XG4gICAgfVxuICAgIHN0b3JhZ2Uuc2V0SXRlbShcbiAgICAgIGtleSxcbiAgICAgIFN0b3JhZ2VVdGlsLnN0cmluZ2lmeSh7XG4gICAgICAgIF9leHBpcmVkOiBTdG9yYWdlVXRpbC5nZXRFeHBpcmVkKGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpLFxuICAgICAgICBfdmFsdWU6IHZhbHVlLFxuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIHN0YXRpYyByZW1vdmUoc3RvcmFnZTogU3RvcmFnZSwga2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gO1xuICAgIH1cbiAgICBzdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgfVxuXG4gIHN0YXRpYyBrZXkoc3RvcmFnZTogU3RvcmFnZSwgaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHN0b3JhZ2UgPT0gbnVsbCA/ICcnIDogc3RvcmFnZS5rZXkoaW5kZXgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RXhwaXJlZCh2YWw6IG51bWJlciwgdW5pdDogRXhwaXJlZFVuaXQpOiBudW1iZXIge1xuICAgIGlmICh2YWwgPD0gMCkgcmV0dXJuIDA7XG4gICAgY29uc3Qgbm93ID0gK25ldyBEYXRlKCk7XG4gICAgc3dpdGNoICh1bml0KSB7XG4gICAgICBjYXNlICdzJzogLy8g56eSXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogdmFsO1xuICAgICAgY2FzZSAnbSc6IC8vIOWIhlxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogdmFsO1xuICAgICAgY2FzZSAnaCc6IC8vIOaXtlxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiB2YWw7XG4gICAgICBjYXNlICdkJzogLy8g5aSpXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiA2MCAqIDI0ICogdmFsO1xuICAgICAgY2FzZSAndyc6IC8vIOWRqFxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIDcgKiB2YWw7XG4gICAgICBjYXNlICd5JzogLy8g5bm0XG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiA2MCAqIDI0ICogMzY1ICogdmFsO1xuICAgICAgY2FzZSAndCc6IC8vIOiHquWumuS5iVxuICAgICAgICByZXR1cm4gbm93ICsgdmFsO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHN0cmluZ2lmeSh2YWx1ZTogYW55KSB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHBhcnNlKHRleHQ6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh0ZXh0KSB8fCBudWxsO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cbiAgfVxufVxuIl19